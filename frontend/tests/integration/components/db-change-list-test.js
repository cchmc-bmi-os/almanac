import { module, test } from 'qunit';
import { setupRenderingTest } from 'ember-qunit';
import { render, find, findAll } from '@ember/test-helpers';
import hbs from 'htmlbars-inline-precompile';

module('Integration | Component | db change list', function(hooks) {
  setupRenderingTest(hooks);
  /*
  <h5>Add these in the DA</h5>
  <ul>
      {{#each changes.adds as |change|}}
          <li class="text-muted">
              {{change.name}}: {{change.text}}
          </li>
      {{else}}
          <li class="text-muted">There are no addition for this DD</li>
      {{/each}}
  </ul>

  <hr/>

  <h5>Update these in the DA</h5>
  <ul>
      {{#each changes.updates as |change|}}
          <li class="text-muted">
              {{change.name}}: {{change.text}}
          </li>
      {{else}}
          <li class="text-muted">There are no updates for this DD</li>
      {{/each}}
  </ul>

  */
  test('it renders', async function(assert) {
    let version = {
      id: 74,
      revision: 8,
      contents: [["u_study_id", "Intake Demographics", null, "text", "NBSTRN ID", "", null, null, null, null, false, null, false, null, 1, null, null], ["site_specific_number", "Demographics", "", "text", "Site Specific Number", "", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_consent_obtained", "Demographics", "", "radio", "Consent obtained", "1, Yes | 2, No | 3, IRB Exempt", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_assent_obtained", "Demographics", "", "radio", "Assent obtained", "1, Yes | 2, No | 3, Not Applicable", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_assent_type", "Demographics", "", "radio", "Type of assent", "1, Written | 2, Verbal", "", "", "", "", "", "[u_assent_obtained]='1'", "", "", "", "", "", ""], ["u_protocol_id", "Intake Demographics", "Consent", "dropdown", "Protocol ID", "1, Cameron (5R01HD069039-03) | 2, Swoboda (5R01HD069045-02) | 3, Wasserstein (1R01HD073292-01)", null, null, null, null, false, null, false, null, 6, null, null], ["u_patient_name", "Demographics", "", "text", "Patient name", "", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_dob", "Demographics", "", "text", "Date of birth", "", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_age_intake", "Demographics", "", "calc", "Age at first assessment (intake)", "round(datediff([u_e_visit_date],[u_dob], \"y\", \"mdy\"), 2)", "", "", "", "", "", "", "", "", "", "", "", ""], ["lsd_patient_info_yn", "Demographics", "", "radio", "Is someone other than the patient providing demographic, medical and family history?", "1, Yes | 2, No | 3, Unknown", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_gest_age_days", "Demographics", "", "text", "Gestational Age (days)", "", "", "", "", "", "", "", "", "", "", "", "", ""], ["u_societal_sex", "Intake Demographics", "Demographics Information", "dropdown", "Societal sex", "1, Unknown | 2, Male | 3, Female", null, null, null, null, false, null, false, "RH", 9, null, null], ["nbs_asm_mean_1", "Enzyme Mutation Analysis", "", "text", "ASM (% mean) on first newborn screen", "", "", "", "", "", "", "([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(2)]='1'", "", "", "", "", "", ""], ["nbs_alpha_gal_1", "Enzyme Mutation Analysis", "", "text", "Alpha-GAL on first newborn screen", "", "", "", "", "", "", "([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'", "", "", "", "", "", ""], ["nbs_alpha_gal_mean_1", "Enzyme Mutation Analysis", "", "text", "Alpha-GAL (% mean) on first newborn screen", "", "", "", "", "", "", "([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'", "", "", "", "", "", ""]],
      summary: null,
      actions: null,
      info: 'Final Data Dictionary',
      is_locked: true
    };
    let accepted = {"all":[["u_study_id","Demographics","","text","NBSTRN ID","Autopopulated?","How will this be generated on the MSSM instance?","","","","","","","","","","",""],["site_specific_number","Demographics","","text","Site Specific Number","","","","","","","","","","","","",""],["u_consent_obtained","Demographics","","radio","Consent obtained","1, Yes | 2, No | 3, IRB Exempt","","","","","","","","","","","",""],["u_assent_obtained","Demographics","","radio","Assent obtained","1, Yes | 2, No | 3, Not Applicable","","","","","","","","","","","",""],["u_assent_type","Demographics","","radio","Type of assent","1, Written | 2, Verbal","","","","","","[u_assent_obtained]='1'","","","","","",""],["u_protocol_id","Demographics","","dropdown","Protocol ID","1, Cameron (5R01HD069039-03) | 2, Swoboda (5R01HD069045-02) | 3, Wasserstein (1R01HD073292-03)","","","","","","","","","","","",""],["u_patient_name","Demographics","","text","Patient name","","","","","","","","","","","","",""],["u_dob","Demographics","","text","Date of birth","","","","","","","","","","","","",""],["u_age_intake","Demographics","","calc","Age at first assessment (intake)","round(datediff([u_e_visit_date],[u_dob], \"y\", \"mdy\"), 2)","","","","","","","","","","","",""],["lsd_patient_info_yn","Demographics","","radio","Is someone other than the patient providing demographic, medical and family history?","1, Yes | 2, No | 3, Unknown","","","","","","","","","","","",""],["u_gest_age_days","Demographics","","text","Gestational Age (days)","","","","","","","","","","","","",""],["u_societal_sex","Demographics","","radio","Societal sex","1, Unknown | 2, Male | 3, Female | 4, Ambiguous","","","","","","","","","","","",""],["nbs_asm_mean_1","Enzyme Mutation Analysis","","text","ASM (% mean) on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(2)]='1'","","","","","",""],["nbs_alpha_gal_1","Enzyme Mutation Analysis","","text","Alpha-GAL on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","","","","","",""],["nbs_alpha_gal_mean_1","Enzyme Mutation Analysis","","text","Alpha-GAL (% mean) on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","","","","","",""]],"found":[["u_assent_type","Demographics","","radio","Type of assent","1, Written | 2, Verbal","","","","","","[u_assent_obtained]='1'","","","","","",""],["u_dob","Demographics","","text","Date of birth","","","","","","","","","","","","",""]],"different":[{"uploaded":["u_study_id","Demographics","","text","NBSTRN ID","Autopopulated?","How will this be generated on the MSSM instance?","","","","","","","","","","",""],"differences":["5"],"possible":[{"similarity":0,"name":"u_study_id","id":2987,"site":"IBEMC","text":"NBSTRN ID"},{"similarity":3,"name":"u_study_id__d","id":8548,"site":"LSD","text":"NBSTRN ID"},{"similarity":4,"name":"u_study_id__ph","id":10119,"site":"Public Health","text":"NBSTRN ID"},{"similarity":5,"name":"nbstrn_id","id":8389,"site":"NBSTRN Core","text":"NBSTRN ID"},{"similarity":11,"name":"study_id__d","id":13986,"site":"Arkansas CDE","text":"Study ID"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Intake Demographics","name":"u_study_id","text":"NBSTRN ID","identifier":"False","type":"text","max_val":null,"align":null,"branching_logic":null,"choices":"","section":null,"ordering":1,"matrix_name":null,"note":null,"min_val":null}},{"uploaded":["u_consent_obtained","Demographics","","radio","Consent obtained","1, Yes | 2, No | 3, IRB Exempt","","","","","","","","","","","",""],"differences":["5"],"possible":[{"similarity":0,"name":"u_consent_obtained","id":8284,"site":"IBEMC","text":"Consent obtained"},{"similarity":0,"name":"u_consent_obtained","id":8550,"site":"LSD","text":"Consent obtained"},{"similarity":2,"name":"consent_obtained","id":8391,"site":"NBSTRN Core","text":"Consent obtained"},{"similarity":6,"name":"u_assent_obtained","id":358,"site":"IBEMC","text":"Assent obtained"},{"similarity":9,"name":"u_assent_obtained__d","id":8551,"site":"LSD","text":"Assent obtained"}],"database":{"calculation":null,"required":"True","matrix_ranking":null,"form":"Demographics","name":"u_consent_obtained","text":"Consent obtained","identifier":"False","type":"radio","max_val":null,"align":"RH","branching_logic":"","choices":"1, 1 | 2, 2 | 3, 3","section":"Consent","ordering":3,"matrix_name":"","note":"","min_val":null}},{"uploaded":["u_assent_obtained","Demographics","","radio","Assent obtained","1, Yes | 2, No | 3, Not Applicable","","","","","","","","","","","",""],"differences":["5"],"possible":[{"similarity":0,"name":"u_assent_obtained","id":358,"site":"IBEMC","text":"Assent obtained"},{"similarity":3,"name":"u_assent_obtained__d","id":8551,"site":"LSD","text":"Assent obtained"},{"similarity":6,"name":"u_consent_obtained","id":8284,"site":"IBEMC","text":"Consent obtained"},{"similarity":6,"name":"u_consent_obtained","id":8550,"site":"LSD","text":"Consent obtained"},{"similarity":7,"name":"consent_obtained","id":8391,"site":"NBSTRN Core","text":"Consent obtained"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Intake Demographics","name":"u_assent_obtained","text":"Assent obtained","identifier":"False","type":"radio","max_val":null,"align":"RH","branching_logic":null,"choices":"1, Yes | 2, No","section":"Consent","ordering":3,"matrix_name":null,"note":null,"min_val":null}},{"uploaded":["u_protocol_id","Demographics","","dropdown","Protocol ID","1, Cameron (5R01HD069039-03) | 2, Swoboda (5R01HD069045-02) | 3, Wasserstein (1R01HD073292-03)","","","","","","","","","","","",""],"differences":["5"],"possible":[{"similarity":0,"name":"u_protocol_id","id":3475,"site":"IBEMC","text":"Protocol ID"},{"similarity":15,"name":"u_study_id","id":2987,"site":"IBEMC","text":"NBSTRN ID"},{"similarity":15,"name":"prolactin_i","id":8005,"site":"IBEMC","text":"Prolactin"},{"similarity":16,"name":"record_id","id":10155,"site":"Precision Perinatology","text":"Family ID"},{"similarity":17,"name":"u_chm_k","id":8342,"site":"IBEMC","text":"Potassium"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Intake Demographics","name":"u_protocol_id","text":"Protocol ID","identifier":"False","type":"dropdown","max_val":null,"align":null,"branching_logic":null,"choices":"1, Cameron (5R01HD069039-03) | 2, Swoboda (5R01HD069045-02) | 3, Wasserstein (1R01HD073292-01)","section":"Consent","ordering":6,"matrix_name":null,"note":null,"min_val":null}},{"uploaded":["u_gest_age_days","Demographics","","text","Gestational Age (days)","","","","","","","","","","","","",""],"differences":["0"],"possible":[{"similarity":3,"name":"lsd_gest_age_days","id":8558,"site":"LSD","text":"Gestational Age (days)"},{"similarity":11,"name":"lsd_gest_age_weeks","id":8557,"site":"LSD","text":"Gestational Age (weeks)"},{"similarity":14,"name":"gestage_cde","id":10565,"site":"Precision Perinatology","text":"Gestational Age (In weeks)"},{"similarity":19,"name":"gestational_age","id":14076,"site":"Arkansas CDE","text":"Gestational Age"},{"similarity":19,"name":"u_gestational_age","id":3478,"site":"IBEMC","text":"Gestational age in weeks"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Demographics","name":"lsd_gest_age_days","text":"Gestational Age (days)","identifier":"False","type":"text","max_val":6,"align":"","branching_logic":"","choices":"","section":null,"ordering":11,"matrix_name":"","note":"","min_val":-1}},{"uploaded":["u_societal_sex","Demographics","","radio","Societal sex","1, Unknown | 2, Male | 3, Female | 4, Ambiguous","","","","","","","","","","","",""],"differences":["5"],"possible":[{"similarity":0,"name":"u_societal_sex","id":3479,"site":"IBEMC","text":"Societal sex"},{"similarity":3,"name":"lsd_societal_sex","id":8559,"site":"LSD","text":"Societal sex"},{"similarity":14,"name":"u_biological_sex","id":3480,"site":"IBEMC","text":"Biological sex"},{"similarity":16,"name":"special_diet","id":16778,"site":"Arkansas Hemoglobinopathies","text":"Special Diet"},{"similarity":17,"name":"skeletal_survey","id":13953,"site":"Arkansas CAH","text":"Skeletal Survey"}],"database":{"calculation":null,"required":"True","matrix_ranking":null,"form":"Intake Demographics","name":"u_societal_sex","text":"Societal sex","identifier":"False","type":"dropdown","max_val":null,"align":"RH","branching_logic":null,"choices":"1, Unknown | 2, Male | 3, Female","section":"Demographics Information","ordering":9,"matrix_name":null,"note":null,"min_val":null}},{"uploaded":["nbs_asm_mean_1","Enzyme Mutation Analysis","","text","ASM (% mean) on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(2)]='1'","","","","","",""],"differences":["4"],"possible":[{"similarity":6,"name":"nbs_asm_mean_1","id":8617,"site":"LSD","text":"ASM (% daily mean) on first newborn screen"},{"similarity":11,"name":"nbs_asm_mean_3","id":8653,"site":"LSD","text":"ASM (% daily mean) on third newborn screen"},{"similarity":12,"name":"nbs_galc_mean_1","id":8626,"site":"LSD","text":"GALC (% daily mean) on first newborn screen"},{"similarity":13,"name":"nbs_asm_mean_2","id":8635,"site":"LSD","text":"ASM (% daily mean) on second newborn screen"},{"similarity":14,"name":"nbs_asm_1","id":8616,"site":"LSD","text":"ASM on first newborn screen"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Enzymemutation Analysis","name":"nbs_asm_mean_1","text":"ASM (% daily mean) on first newborn screen","identifier":"False","type":"text","max_val":100,"align":"","branching_logic":"([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(2)]='1'","choices":"","section":null,"ordering":70,"matrix_name":"","note":"","min_val":-1}},{"uploaded":["nbs_alpha_gal_1","Enzyme Mutation Analysis","","text","Alpha-GAL on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","","","","","",""],"differences":["4"],"possible":[{"similarity":12,"name":"nbs_ala_1","id":155,"site":"IBEMC","text":"Alanine on first newborn screen"},{"similarity":15,"name":"nbs_val_1","id":156,"site":"IBEMC","text":"Valine on first newborn screen"},{"similarity":15,"name":"nbs_arg_1","id":7883,"site":"IBEMC","text":"Arginine on first newborn screen"},{"similarity":16,"name":"nbs_abg_1","id":8620,"site":"LSD","text":"ABG result on first newborn screen"},{"similarity":16,"name":"nbs_asm_1","id":8616,"site":"LSD","text":"ASM on first newborn screen"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Enzymemutation Analysis","name":"nbs_alpha_gal_1","text":"Alpha-GAL enzyme activity on first newborn screen (umol/L/hr)","identifier":"False","type":"text","max_val":null,"align":"","branching_logic":"([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","choices":"","section":null,"ordering":71,"matrix_name":"","note":"","min_val":null}},{"uploaded":["nbs_alpha_gal_mean_1","Enzyme Mutation Analysis","","text","Alpha-GAL (% mean) on first newborn screen","","","","","","","([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","","","","","",""],"differences":["4"],"possible":[{"similarity":6,"name":"nbs_alpha_gal_mean_1","id":8619,"site":"LSD","text":"Alpha-GAL (% daily mean) on first newborn screen"},{"similarity":11,"name":"nbs_alpha_gal_mean_3","id":8655,"site":"LSD","text":"Alpha-GAL (% daily mean) on third newborn screen"},{"similarity":13,"name":"nbs_alpha_gal_mean_2","id":8637,"site":"LSD","text":"Alpha-GAL (% daily mean) on second newborn screen"},{"similarity":19,"name":"nbs_galc_mean_1","id":8626,"site":"LSD","text":"GALC (% daily mean) on first newborn screen"},{"similarity":19,"name":"nbs_asm_mean_1","id":8617,"site":"LSD","text":"ASM (% daily mean) on first newborn screen"}],"database":{"calculation":null,"required":"False","matrix_ranking":null,"form":"Enzymemutation Analysis","name":"nbs_alpha_gal_mean_1","text":"Alpha-GAL (% daily mean) on first newborn screen","identifier":"False","type":"text","max_val":100,"align":"","branching_logic":"([u_nbs_num] = '3' or [u_nbs_num] = '4' or [u_nbs_num] = '5') and [intake_arm_1][u_cond_cand(3)]='1'","choices":"","section":null,"ordering":72,"matrix_name":"","note":"","min_val":-1}}],"not_found":[{"uploaded":["site_specific_number","Demographics","","text","Site Specific Number","","","","","","","","","","","","",""],"possible":[{"similarity":22,"name":"hosp_number","id":14011,"site":"Arkansas CDE","text":"Hospital Number"},{"similarity":25,"name":"urine_spec_grav","id":9859,"site":"LSD","text":"Specific gravity"},{"similarity":26,"name":"clinic_name","id":14010,"site":"Arkansas CDE","text":"Clinic Name"},{"similarity":26,"name":"special_diet","id":16778,"site":"Arkansas Hemoglobinopathies","text":"Special Diet"},{"similarity":26,"name":"home_phone","id":14032,"site":"Arkansas CDE","text":"Home Phone Number"}]},{"uploaded":["u_patient_name","Demographics","","text","Patient name","","","","","","","","","","","","",""],"possible":[{"similarity":10,"name":"u_patient_last_name","id":8554,"site":"LSD","text":"Patient last name"},{"similarity":10,"name":"u_patient_last_name","id":2603,"site":"IBEMC","text":"Patient last name"},{"similarity":12,"name":"patient_last_name","id":8393,"site":"NBSTRN Core","text":"Patient last name"},{"similarity":12,"name":"u_patient_first_name","id":2606,"site":"IBEMC","text":"Patient first name"},{"similarity":13,"name":"dad_name","id":10220,"site":"Precision Perinatology","text":"Father's name"}]},{"uploaded":["u_age_intake","Demographics","","calc","Age at first assessment (intake)","round(datediff([u_e_visit_date],[u_dob], \"y\", \"mdy\"), 2)","","","","","","","","","","","",""],"possible":[{"similarity":29,"name":"age_onset","id":10554,"site":"Precision Perinatology","text":"Age of Symptom Onset"},{"similarity":29,"name":"insurance_intake","id":8421,"site":"NBSTRN Core","text":"Medical coverage at time of intake"},{"similarity":30,"name":"u_assent_type","id":2567,"site":"IBEMC","text":"Type of assent"},{"similarity":30,"name":"u_insurance_intake","id":3596,"site":"IBEMC","text":"Medical coverage at time of intake"},{"similarity":30,"name":"visit_age","id":8920,"site":"LSD","text":"Age at visit"}]},{"uploaded":["lsd_patient_info_yn","Demographics","","radio","Is someone other than the patient providing demographic, medical and family history?","1, Yes | 2, No | 3, Unknown","","","","","","","","","","","",""],"possible":[{"similarity":68,"name":"sa_variants_yn","id":10632,"site":"Precision Perinatology","text":"Are there variants to document at this time?"},{"similarity":68,"name":"consent4_yn","id":10440,"site":"Precision Perinatology","text":"Were there more than three times consent was obtained for this family?"},{"similarity":68,"name":"hand_bone_age__at","id":9551,"site":"LSD","text":"Bone age of the patient (year/month) based on hand x-ray results"},{"similarity":69,"name":"pa_variants_yn","id":11395,"site":"Precision Perinatology","text":"Are there variants to document at this time?"},{"similarity":69,"name":"sa_pattern","id":10626,"site":"Precision Perinatology","text":"Inheritance pattern for diagnosis/candidate gene"}]}]};
    this.set('version', version);
    this.set('accepted', accepted);
    await render(hbs`{{db-change-list version=version accepted=accepted}}`);

    assert.ok(find('.db-adds'));
    assert.ok(find('.db-updates'));
    assert.equal(find('.db-adds h5').textContent.trim(), 'Add these in the DA', 'it has the correct header for adds');
    assert.equal(find('.db-updates h5').textContent.trim(), 'Update these in the DA', 'it has the correct header for updates');
    assert.equal(findAll('.db-adds .text-muted').length, 1, 'adds has one entry');
    assert.equal(findAll('.db-updates .text-muted').length, 1, 'updates has one entry');
  });
});
